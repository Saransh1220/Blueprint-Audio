<div class="profile-container">
  <!-- Page Header -->
  <header class="page-header">
    <h1>Profile Settings</h1>
    <p>Manage your account and preferences</p>
  </header>

  <form [formGroup]="profileForm">
    <!-- Top Section: Avatar + Info -->
    <div class="top-grid">
      <!-- Avatar Card -->
      <div class="card avatar-card">
        <div class="avatar-display">
          @if (avatarPreview()) {
            <div class="avatar" [style.background-image]="'url(' + avatarPreview() + ')'"></div>
          } @else if (currentUser()?.avatar_url) {
            <div
              class="avatar"
              [style.background-image]="'url(' + currentUser()?.avatar_url + ')'"
            ></div>
            <button
              type="button"
              class="delete-avatar-btn"
              (click)="deleteAvatar()"
              title="Delete avatar"
            >
              <i class="fas fa-trash"></i>
            </button>
          } @else {
            <div class="avatar avatar-fallback">
              {{ currentUser()?.name?.charAt(0) || 'U' }}
            </div>
          }
        </div>

        <input
          type="file"
          #avatarInput
          (change)="onAvatarFileSelected($event)"
          accept="image/*"
          style="display: none"
        />

        @if (selectedAvatarFile()) {
          <div class="avatar-controls">
            <button
              type="button"
              class="btn-icon btn-upload"
              (click)="uploadAvatar()"
              [disabled]="isUploadingAvatar()"
              title="Upload"
            >
              @if (isUploadingAvatar()) {
                <i class="fas fa-spinner fa-spin"></i>
              } @else {
                <i class="fas fa-check"></i>
              }
            </button>
            <button
              type="button"
              class="btn-icon btn-cancel"
              (click)="cancelAvatarUpload()"
              title="Cancel"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        } @else {
          <button type="button" class="btn-change" (click)="avatarInput.click()">
            <i class="fas fa-camera"></i>
            <span>Change Photo</span>
          </button>
        }
      </div>

      <!-- User Info Card -->
      <div class="card info-card">
        <div class="user-header">
          <div class="badge">
            <i class="fas fa-{{ currentUser()?.role === Role.PRODUCER ? 'crown' : 'music' }}"></i>
            {{ currentUser()?.role }}
          </div>
        </div>
        <h2>{{ currentUser()?.name }}</h2>
        <p class="email">{{ currentUser()?.email }}</p>

        <button
          type="button"
          class="btn-save"
          (click)="saveProfile()"
          [disabled]="!profileForm.dirty || isSaving()"
        >
          @if (isSaving()) {
            <i class="fas fa-spinner fa-spin"></i>
            <span>Saving...</span>
          } @else {
            <i class="fas fa-save"></i>
            <span>Save Changes</span>
          }
        </button>
      </div>
    </div>

    <!-- Bio Card -->
    <div class="card bio-card">
      <label class="card-label">
        <i class="fas fa-align-left"></i>
        About
      </label>
      <textarea
        formControlName="bio"
        rows="4"
        placeholder="Tell us about yourself..."
        maxlength="500"
      ></textarea>
      <span class="char-count">{{ profileForm.get('bio')?.value?.length || 0 }}/500</span>
    </div>

    <!-- Social Links Card -->
    <div class="card social-card">
      <label class="card-label">
        <i class="fas fa-link"></i>
        Social Links
      </label>

      <div class="social-grid">
        <div class="social-item">
          <div class="social-icon instagram">
            <i class="fab fa-instagram"></i>
          </div>
          <input type="url" formControlName="instagram_url" placeholder="Instagram URL" />
        </div>

        <div class="social-item">
          <div class="social-icon twitter">
            <i class="fab fa-twitter"></i>
          </div>
          <input type="url" formControlName="twitter_url" placeholder="Twitter URL" />
        </div>

        <div class="social-item">
          <div class="social-icon youtube">
            <i class="fab fa-youtube"></i>
          </div>
          <input type="url" formControlName="youtube_url" placeholder="YouTube URL" />
        </div>

        <div class="social-item">
          <div class="social-icon spotify">
            <i class="fab fa-spotify"></i>
          </div>
          <input type="url" formControlName="spotify_url" placeholder="Spotify URL" />
        </div>
      </div>
    </div>
  </form>
</div>
<app-confirm-dialog (confirmed)="onDeleteConfirmed()"></app-confirm-dialog>
